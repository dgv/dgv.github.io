<!doctype html><html lang=en><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#8fbcbb;--font-size:17.5px}</style><title>zig for golang programmers</title><meta name=description content="tl;dr
I have been using Go for more than a decade, here I will explain my main motivations to use Zig over Rust (which I am still learning too) and will give â€¦"><meta name=keywords content='blog,devlog,golang,zig,openbsd,web3'><meta property="og:url" content="http://localhost:1313/posts/2024-06-21-zig-for-golang-programmers/"><meta property="og:type" content="website"><meta property="og:title" content="zig for golang programmers"><meta property="og:description" content="tl;dr
I have been using Go for more than a decade, here I will explain my main motivations to use Zig over Rust (which I am still learning too) and will give â€¦"><meta property="og:image" content="http://localhost:1313/img/dgv_dev_br.png"><meta property="og:image:secure_url" content="http://localhost:1313/img/dgv_dev_br.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="zig for golang programmers"><meta name=twitter:description content="tl;dr
I have been using Go for more than a decade, here I will explain my main motivations to use Zig over Rust (which I am still learning too) and will give â€¦"><meta property="twitter:domain" content="http://localhost:1313/posts/2024-06-21-zig-for-golang-programmers/"><meta property="twitter:url" content="http://localhost:1313/posts/2024-06-21-zig-for-golang-programmers/"><meta name=twitter:image content="http://localhost:1313/img/dgv_dev_br.png"><link rel=canonical href=http://localhost:1313/posts/2024-06-21-zig-for-golang-programmers/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.70293498aa96b2dbb767ec11a622eb2266d8fc37a0fff88233a82952e3c72b15.js integrity="sha256-cCk0mKqWstu3Z+wRpiLrImbY/Deg//iCM6gpUuPHKxU="></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css integrity=sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js integrity=sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js integrity=sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=http://localhost:1313/><img src=/img/dgv_dev_br.png alt=avatar></a></div><div class=nav-title><a class=nav-brand href=http://localhost:1313/>dgv</a></div><div class=nav-links><div class=nav-link><a href=http://localhost:1313/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=http://localhost:1313/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=http://localhost:1313/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=http://localhost:1313/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=http://localhost:1313/tips/ aria-label><span data-feather=info></span> Tips</a></div><div class=nav-link><a href=https://github.com/dgv aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=http://localhost:1313/index.xml aria-label=rss><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=http://localhost:1313/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=http://localhost:1313/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=http://localhost:1313/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=http://localhost:1313/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=http://localhost:1313/tips/><span data-feather=info></span> Tips</a></li><li class=nav-item><a href=https://github.com/dgv><span data-feather=github></span></a></li><li class=nav-item><a href=http://localhost:1313/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>zig for golang programmers</h1><small role=doc-subtitle></small><p class=post-date>June 21, 2024</p><ul class=post-tags></ul></div><div class=post-content><p>tl;dr</p><p>I have been using Go for more than a decade, here I will explain my main motivations to use Zig over Rust (which I am still learning too) and
will give some quick examples of interesting features in comparison with Go.</p><p>10 points</p><p><a href=https://medium.com/@vladimirvivien/things-i-like-about-zig-as-a-go-programmer-75eb02aab00f>https://medium.com/@vladimirvivien/things-i-like-about-zig-as-a-go-programmer-75eb02aab00f</a></p><h2 id=sumary>sumary</h2><ul><li><a href>motivations</a><ul><li><a href=#values>values</a></li></ul></li><li><a href>why not rust?</a></li><li>new stuff<ul><li><a href>build system (aka zig trojan)</a></li><li><a href>memory allocation</a></li><li><a href>wtf is comptime</a></li></ul></li><li>cool diffs<ul><li><a href>error handling</a></li><li><a href>test stuff together</a></li><li><a href>concurrency</a></li><li><a href>easy C interoperability</a></li><li><a href>btw generics</a></li><li><a href><em>habemus</em> stdlib</a><ul><li>udp, regexp,time</li></ul></li><li><a href>finally small binaries</a></li></ul></li><li><a href>some tips</a></li><li><a href>final thoughts</a></li><li><a href=#references>more references</a></li></ul><h2 id=motivations>motivations</h2><p>I&rsquo;ve been using go over a decade and never considered it as <em>systems language</em>, but as <em>cloud language</em>, my first project was rest api using gorilla in 2012.
complete toolchain, rich stdlib, concurrency.</p><p>The most famous cases are <a href>Tigerbetle</a> finacial database, and bun runtime, but <a href=https://www.uber.com/en-US/blog/bootstrapping-ubers-infrastructure-on-arm64-with-zig/>Uber</a>, <a href=https://vercel.com/blog/how-we-continued-porting-turborepo-to-rust>Vercel</a> and <a href=https://turso.tech/blog/zig-helped-us-move-data-to-the-edge-here-are-our-impressions-67d3a9c45af4>Turso</a> are also using in production.
Is impressive for a language without stable release developed by so few people.</p><p>I&rsquo;m soloentrepreneur, working solo in big projects, is praticaly impossible to use Rust, it&rsquo;s like Jonathan Blow says, I dont have time for it, if you dont know how implement something, forget, and dont want to feel like <a href=https://users.rust-lang.org/t/feeling-down-about-rust-for-serious-projects/103093>these guy</a> after months.</p><p>As described, I&rsquo;m not comming from C++, undergraduate electrical engineer, I&rsquo;m want things done, easy to hack,
borrow checking, type system, macros aaaahh my eyes&mldr; yikes&mldr;good luck&mldr;</p><p>so to all of this make some sense to you must enjoy things like or/and not enjoy <a href=https://suckless.org/philosophy/>suckless philosophy</a> stop to read now.</p><p>Compeling Performance
here some data from the benchmark performed by Anton on his <a href="https://www.youtube.com/watch?v=3fWx5BOiUiY">channel</a> using Go (stdlib), Rust (Actix) and Zig (ZZZ) [<a href=https://github.com/antonputra/tutorials/tree/215/lessons/215>source</a>]
the results are impressive for a language before stable version developed by small team.</p><p><img src=/assets/files/perf1.png alt=perf>
<img src=/assets/files/perf2.png alt=perf></p><h2 id=why-not-rust>why not Rust?</h2><p><em>At this point I felt crazy for even considering Rust. I had accomplished more in 4 days what took me 16 days in Rust. But more importantly, my abstractions were holding up.</em><br>Andrew, Creator of Zig on <a href=http://genesisdaw.org/post/progress-so-far.html>progress so far</a></p><p><em>&mldr;the reason I personally donâ€™t like working too much in Rust, I have written Rust, I think as a technology itâ€™s a great language it has great merits but the reason I personally donâ€™t like writing Rust is every project that I read with Rust ends up basically being chase the trade implementation around, itâ€™s like what file is this trait defined, what file is the implementation is, how many implementations are there.. and I feel like Iâ€™m just chasing the traits and I donâ€™t find that particularly.. I donâ€™t know, productive I should say, I like languages that you read start on line one you read ten and thatâ€™s exactly what happened and so I think Zigâ€™s a good fit â€¦</em><br>Michael Matsumoto, former Hashlabs Founder about why he chooses <a href="https://www.youtube.com/watch?v=l_qY2p0OH9A&amp;t=4182s">Zig for Ghostty</a></p><p>Already had to argue about it, had little experience using Rust, and not enjoyed by the same reasons of Michael, I feel like using npm but slower
with cargo&mldr; macros</p><p>I&rsquo;ve been using Go since the stable version 1.0 (~2012), and working professionally since 2013.
The language of hype these days was Node, today is Rust,</p><ul><li><p>values (go vs zig)</p></li><li><p>webassembly
<a href=https://dev.to/sleibrock/webassembly-with-zig-pt-ii-ei7>webassembly-with-zig</a>
<a href=https://wasm4.org/blog/jam-2-results/#programming-language>WASM-4 game jam</a></p></li><li><p>safe/small for embedded <a href=https://kevinlynagh.com/rust-zig/>Why I rewrote my Rust keyboard firmware in Zig: consistency, mastery, and fun</a>
(aka, interruptions oriented programming)</p></li><li><p>no ffi for c
tired of cgo wrappers, makefiles
<a href=https://andrewkelley.me/post/zig-cc-powerful-drop-in-replacement-gcc-clang.html><code>zig cc</code>: a Powerful Drop-In Replacement for GCC/Clang</a>
<a href=https://ludwigabap.bearblog.dev/zig-vs-rust-at-work-the-choice-we-made/>On Zig vs Rust at work and the choice we made</a></p></li><li><p>performance, have control for rtc apps, low mem/latency footprint <a href=https://matklad.github.io/2023/03/26/zig-and-rust.html>Zig And Rust</a></p></li></ul><p><a href=https://blog.afoolishmanifesto.com/posts/golang-zig-cross-compilation/>https://blog.afoolishmanifesto.com/posts/golang-zig-cross-compilation/</a></p><h3 id=values>values</h3><p>Zen of Zig (from <a href><code>zig zen</code></a>)</p><ul><li>Communicate intent precisely.</li><li>Edge cases matter.</li><li>Favor reading code over writing code.</li><li>Only one obvious way to do things.</li><li>Runtime crashes are better than bugs.</li><li>Compile errors are better than runtime crashes.</li><li>Incremental improvements.</li><li>Avoid local maximums.</li><li>Reduce the amount one must remember.</li><li>Focus on code rather than style.</li><li>Resource allocation may fail; resource deallocation must succeed.</li><li>Memory is a resource.</li><li>Together we serve the users.</li></ul><h2 id=how-to-start>how to start</h2><h3 id=docs>docs</h3><p>I personaly recommend to read in the following order: start practice ziglings, then use the lang reference.
<a href=https://pedropark99.github.io/zig-book/>Introduction to Zig</a></p><h3 id=daily-basis-tips>daily basis tips</h3><p>coding and debugging
zls <strong>-freference-trace</strong></p><p>docs goref/zig emit</p><p>cover</p><p>pprof?</p><h3 id=functionsinterfaces>functions/interfaces</h3><h3 id=data-structures--sorting>data structures / sorting</h3><h3 id=strings>strings</h3><h3 id=errors>errors</h3><h3 id=pointers>pointers</h3><h3 id=heap-mem--allocators-add-fluxogram>heap mem & allocators (add fluxogram)</h3><p><img src=/assets/files/allocs.png alt=perf></p><p>refs</p><ul><li><a href=https://ziglang.org/documentation/master/#Choosing-an-Allocator>choosing an allocator</a></li><li><a href=https://www.openmymind.net/learning_zig/heap_memory>heap memory and allocators</a></li><li><a href=https://dayvster.com/blog/zig-allocators-explained/>allocators explained</a></li></ul><h3 id=lifetime--ownership>lifetime & ownership</h3><ul><li><a href=https://ziglang.org/documentation/master/#Lifetime-and-Ownership>Lifetime and Ownership</a></li></ul><h3 id=generics--comptime>generics & comptime</h3><h3 id=concurrency-and-paralellism>concurrency and paralellism</h3><ul><li><p>no use await/async</p></li><li><p>use threads</p></li><li><p>use premptive thread (aka fibers)</p></li></ul><h3 id=what-else-ill-miss>what else i&rsquo;ll miss?</h3><p>-regexp
-timeout, timers and tickers
-tooling</p><h3 id=what-ill-like>what i&rsquo;ll like?</h3><p>-build files (one language for everything)
-testing
-crypto really nice and advanced support on stdlib wrote by (nacl)</p><h2 id=my-use-cases>my use cases</h2><ul><li>wasm (deploy cloudflare/vercel/supabase)</li><li>embeded</li><li>rest (zzz, spa) c10m</li></ul><p>Lets start with three useful examples.</p><p><em>io-opts</em>
test</p><p><em>tutorials</em>
one day youtube based on my interest in rust recommend me this channel, this video from _ specifically,
let&rsquo;s use this as basically &ldquo;modern&rdquo; (people like this term) webservice theses days,
hypotetical backend app running over k8s on cloud monitored using prometheus and grafana&mldr;</p><p>So I added a test without gc, as former sre I&rsquo;m tired to listen devs complaining about Go&rsquo;s GC problems,
that never had &ldquo;I&rsquo;m not invest my time learning go because ha gc&rdquo;
ok good luck</p><h2 id=evaluation-2-performance>evaluation #2: performance</h2><p><em>c10m</em>
have u heard about c10m problem, as former sre I like to benchmark things like,
couple years agor _ wrote a test using golang.</p><h2 id=evaluation-3-small-binaries-finally>evaluation #3: <em>small binaries, finally</em></h2><p><em>webasm</em>
quick example it&rsquo;s some like</p><p>compile with
start with
voila</p><p>But my experience with Golang was trying to use, was great job, but you cant use due binary size =/
So, in zig we have _ project, after some patch you can work as worker on cloudflare ;)</p><h2 id=evaluation-4-look-mom-no-arduino-ide>evaluation #4: <em>look mom, no arduino ide</em></h2><p><em>embedded</em></p><h2 id=evaluation-5-no-makefiles-or-crazy-tooling>evaluation #5: <em>no Makefiles, or crazy tooling</em></h2><p><em>editor</em>
keep it simples stupid, read the funcking build.zig</p><p>I&rsquo;ll write later, but you can see a very good example of reqwritten project of killo antirez editor in zig.</p><p>no makefiles, no ninja, no crazy script lang for build, just</p><h2 id=evaluation-6-zig-build-krakenzig---releasesafe>evaluation #6: <code>zig build kraken.zig --release=safe</code></h2><p><em>is note memory safe</em> is like <em>the problem is the GC</em>, you know, the guy never had a problem, never tried NOGC or runtime.Stop, but <em>the problem is the GC</em>. It&rsquo;s sucks, like the guy from the video &ldquo;I&rsquo;ll learn Rust because of GC&rdquo;.</p><p><strong><em>BUT ZIG IS NOT MEMORY SAFE</em></strong>
Hell yeah ðŸ¤  This is like GC discussion against Go, you know, the guy never tried Runtime, or used NOGC&mldr; I already had and engangement about it, well, if not fits, not fits&mldr;</p><p><a href=https://chadaustin.me/2024/10/intrusive-linked-list-in-rust/>https://chadaustin.me/2024/10/intrusive-linked-list-in-rust/</a></p><p>some considerations, and <a href=https://foundation.rust-lang.org/news/unsafe-rust-in-the-wild-notes-on-the-current-state-of-unsafe-rust/><strong>19.11%</strong> of all crates use <code>unsafe</code> keyword and <strong>34.35%</strong> make a direct function call into another crate that uses the <code>unsafe</code> keyword.</a>
and historically <a href=https://andrewkelley.me/post/unsafe-zig-safer-than-unsafe-rust.html>unsafe Zig was safer than unsafe Rust</a>, you can se a clear example <a href=https://zackoverflow.dev/writing/unsafe-rust-vs-zig/>when Zig is safer and faster than Rust</a> when they rewrotten the entire stdlib.</p><p><em>Zig has more tools for working in a memory-unsafe environment, such as reporting memory leaks in tests. These have been helpful in finding bugs that are out of scope for safe Rust.</em>
<a href=https://www.roc-lang.org/faq.html#rust-and-zig>Why does Roc use both Rust and Zig?</a></p><p>For more, check Jamie <a href=https://www.scattered-thoughts.net/writing/how-safe-is-zig/>post</a> about it, in special the <a href=https://www.scattered-thoughts.net/writing/assorted-thoughts-on-zig-and-rust/>assorted thoughts on zig (and rust)</a>.
You can can also see <a href=https://medium.com/@shyamsundarb/memory-safety-in-c-vs-rust-vs-zig-f78fa903f41e>memory Safety in C++ vs Rust vs Zig</a> comparison from Shyam.</p><p>So based on the refereces above, it&rsquo;s clear that Zig is simpler suitable solution for 20% of the use cases of Rust, zig is already building, it can be a signal</p><p>So for me Zig is pretty compeling alternative than Rust.</p><p>Like Go, a simpler solution will always replace a complex one who make the same thing&mldr;</p><h2 id=final-considerations>final considerations</h2><p>Have to rewrite project with your team to improve performance for next month? Forget, go ahead with Rust&mldr;
You are alone, need to deal with other languages like C/C++ and like to learn reading source code and hack stuff, you are welcome.</p><p>Todays Zig is Tiobe top50, besides many influencers most of people seems expecting the 1.0.0 version, totally plausible like me when started
to use Golang. But Zig have trojan strategy in my opinion, this thing of have a complete c compiler and build system make it spread,</p><ul><li>zig with go</li><li>zig with elixir</li><li>zig with rust (redis)</li></ul><p><em>highlight features & notes</em></p><ul><li>what you read is what you get
I&rsquo;m so tired trying to learn some Rust, so many things, no macros, weird abstractions, each library is different universe, you dont have stdlib,
but all projects use serde and tokyio&mldr;</li><li>safety
leaky example</li><li>one language for all</li><li>manage packages with Zon
was nice start using zig 0.11.0 vendoring my deps by hand and one month later be using build.zig.zon<pre tabindex=0><code class=language-build.zig.zon data-lang=build.zig.zon></code></pre></li><li>strings
annoyed by <code>[_][]const u8</code>? you can use interface string</li><li>!?
test test
hahah test<div class=highlight><pre tabindex=0 class=chroma><code class=language-zig data-lang=zig><span class=line><span class=cl><span class=k>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>```</span><span class=w>
</span></span></span></code></pre></div></li><li>write tests are easer, yout dont need create another file, repeat the imports to write tests, you are free to write them repesctivelly.</li><li>error handling
not boring as java, use try OR catch, lazy raise using enum</li><li>not only defer, you have errdefer also</li><li>forget cgo, @cImport</li><li>small bins
Zig miracle produces binaries smallest as C</li><li>language server support</li><li>historically unsafe zig code was safer than rust unsafe code</li><li>biggest reference projects are bun, tigerbettle and</li><li>love small comms, powered by individuals</li><li>llvm support by, if you care</li></ul><p><em>bad things</em></p><ul><li>no 1.0.0 yet
yep, your project will broke on next release, will require your attencion and patience while the team work speedin up the compiler,
but stay tunned, just follow the changes on zig.news</li><li>no book
if you&rsquo;re old school lerner who needs a book I dont expect to see one good before the stable version</li><li>lack of parts on stdlib
have bugs and is incomplete, but let be honest, is incredible hard some other language have decent one like Go.</li></ul></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#sumary>sumary</a></li><li><a href=#motivations>motivations</a></li><li><a href=#why-not-rust>why not Rust?</a><ul><li><a href=#values>values</a></li></ul></li><li><a href=#how-to-start>how to start</a><ul><li><a href=#docs>docs</a></li><li><a href=#daily-basis-tips>daily basis tips</a></li><li><a href=#functionsinterfaces>functions/interfaces</a></li><li><a href=#data-structures--sorting>data structures / sorting</a></li><li><a href=#strings>strings</a></li><li><a href=#errors>errors</a></li><li><a href=#pointers>pointers</a></li><li><a href=#heap-mem--allocators-add-fluxogram>heap mem & allocators (add fluxogram)</a></li><li><a href=#lifetime--ownership>lifetime & ownership</a></li><li><a href=#generics--comptime>generics & comptime</a></li><li><a href=#concurrency-and-paralellism>concurrency and paralellism</a></li><li><a href=#what-else-ill-miss>what else i&rsquo;ll miss?</a></li><li><a href=#what-ill-like>what i&rsquo;ll like?</a></li></ul></li><li><a href=#my-use-cases>my use cases</a></li><li><a href=#evaluation-2-performance>evaluation #2: performance</a></li><li><a href=#evaluation-3-small-binaries-finally>evaluation #3: <em>small binaries, finally</em></a></li><li><a href=#evaluation-4-look-mom-no-arduino-ide>evaluation #4: <em>look mom, no arduino ide</em></a></li><li><a href=#evaluation-5-no-makefiles-or-crazy-tooling>evaluation #5: <em>no Makefiles, or crazy tooling</em></a></li><li><a href=#evaluation-6-zig-build-krakenzig---releasesafe>evaluation #6: <code>zig build kraken.zig --release=safe</code></a></li><li><a href=#final-considerations>final considerations</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>